---

### Step 309.2: Update the Barrel File

Update `src/app/framework/services/index.ts`:

```typescript
// src/app/framework/services/index.ts
// VERSION 8 (Section 309) - Added UserPreferencesService

export * from './url-state.service';
export * from './api.service';
export * from './request-coordinator.service';
export * from './domain-config-registry.service';
export * from './domain-config-validator.service';
export * from './popout-context.service';
export * from './popout-manager.service';
export * from './user-preferences.service';
export * from './resource-management.service';
```

---

## Verification

### 1. Check File Exists

```bash
$ ls -la src/app/framework/services/user-preferences.service.ts
```

### 2. TypeScript Compilation Check

```bash
$ npx tsc --noEmit src/app/framework/services/user-preferences.service.ts
```

### 3. Build the Application

```bash
$ ng build
```

### 4. Verify Storage (Optional)

```typescript
// In any component
constructor(private prefs: UserPreferencesService) {
  // Save order
  this.prefs.savePanelOrder(['panel-b', 'panel-a', 'panel-c']);

  // Check localStorage in DevTools
  // Key: prefs:automobile:panelOrder
  // Value: ["panel-b","panel-a","panel-c"]

  // Subscribe to changes
  this.prefs.getPanelOrder().subscribe(order => {
    console.log('Current order:', order);
  });
}
```

---

## Common Problems

| Symptom | Cause | Solution |
|---------|-------|----------|
| Preferences not persisting | localStorage unavailable | Check private browsing mode |
| Wrong domain detected | URL pattern mismatch | Check extractCurrentDomain() logic |
| New panels missing | Not in DEFAULT_PANEL_ORDER | Update defaults when adding panels |
| Quota exceeded | Too much data | Clear old preferences or reduce data |
| JSON parse error | Corrupted data | Service handles with try/catch |

---

## Key Takeaways

1. **Graceful degradation is essential** — App works even if storage fails
2. **Domain namespacing enables multi-domain support** — Preferences don't conflict
3. **Panel merge logic handles updates** — New panels appear at correct positions