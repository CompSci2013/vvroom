---

## Common Problems

| Symptom | Cause | Solution |
|---------|-------|----------|
| Chart shows no data | `topModels` array empty | Verify API returns model data |
| Labels show "undefined undefined" | Missing manufacturer or name | Check `topModels` array structure |
| "Ford:Mustang:Mach-E" (two colons) | Multiple `replace()` calls | Use `replace(' ', ':')` not `replaceAll` |
| Segmentation not detected | Nested check failing | Verify `modelsByManufacturer` has expected structure |
| Labels overlap | Bottom margin too small | Increase `b` value in margins |
| `Cannot find module '../models/automobile.statistics'` | VehicleStatistics not created | Complete document 403 first |

---

## Key Takeaways

1. **Nested data requires flattening** — Transform hierarchical API responses into flat arrays for charting
2. **Display format differs from URL format** — Convert human-readable labels to machine-parseable parameters
3. **Fallback data sources add resilience** — Handle multiple API response formats gracefully

---

## Acceptance Criteria

- [ ] File exists at `src/app/domain-config/automobile/chart-sources/top-models-chart-source.ts`
- [ ] Class `TopModelsChartDataSource` extends `ChartDataSource<VehicleStatistics>`
- [ ] Handles both `modelsByManufacturer` (segmented) and `topModels` (array) formats
- [ ] Labels show "Manufacturer Model" format (e.g., "Toyota Camry")
- [ ] `handleClick` converts to "Manufacturer:Model" format
- [ ] `toUrlParams` maps values to `modelCombos` or `h_modelCombos` parameters
- [ ] Bottom margin (140px) accommodates long model names
- [ ] Code compiles without TypeScript errors (after dependencies are created)

---

## Phase 7 Complete

You have now completed all chart data sources for the automobile domain:

| Document | Chart Source | Data Property | URL Parameter |
|----------|-------------|---------------|---------------|
| 651 | ManufacturerChartDataSource | `byManufacturer` | `manufacturer` |
| 652 | YearChartDataSource | `byYearRange` | `year`, `yearMin`, `yearMax` |
| 653 | BodyClassChartDataSource | `byBodyClass` | `bodyClass` |
| 654 | TopModelsChartDataSource | `modelsByManufacturer`, `topModels` | `modelCombos` |

**Phase 7 Aha Moment:** "Chart sources transform domain data into visualization-ready formats."

Each chart source:
- Transforms domain statistics into Plotly traces and layouts
- Handles both simple and segmented (highlighted) data
- Converts user interactions into URL parameters