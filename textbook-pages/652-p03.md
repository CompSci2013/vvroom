---

### Step 652.2: Understanding Chronological Sorting

Unlike the manufacturer chart (which sorts by count descending), the year chart sorts chronologically:

```typescript
const sorted = entries
  .sort((a, b) => parseInt(a[0], 10) - parseInt(b[0], 10)); // Sort by year ascending
```

**Why ascending order?**

Time flows forward. Users expect to see older years on the left and newer years on the right. This matches mental models of timelines and makes trends (growth or decline over time) immediately visible.

---

### Step 652.3: Understanding Category Type for X-Axis

Notice the layout configuration for the x-axis:

```typescript
xaxis: {
  title: { text: '' },
  gridcolor: '#333333',
  type: 'category',  // Treat years as categories, not numbers
  color: '#FFFFFF'
}
```

**Why `type: 'category'`?**

Without this setting, Plotly would treat years as continuous numbers and might:
- Add decimal ticks (2015.5)
- Create gaps for missing years
- Misalign bars with labels

By specifying `type: 'category'`, each year becomes a discrete label with evenly spaced bars.

---

### Step 652.4: Understanding Range Selection

The `handleClick` method demonstrates sophisticated selection handling:

```typescript
handleClick(event: any): string | null {
  if (event.points && event.points.length > 0) {
    // Extract all years from selected points
    const years: number[] = event.points.map((point: any) => parseInt(point.x, 10));

    // Remove duplicates (box selection may select both stacked bars)
    const uniqueYears: number[] = [...new Set(years)].sort((a, b) => a - b);

    if (uniqueYears.length === 1) {
      // Single year selected
      return uniqueYears[0].toString();
    } else {
      // Multiple years: return as range min|max
      const min = uniqueYears[0];
      const max = uniqueYears[uniqueYears.length - 1];
      return `${min}|${max}`;
    }
  }
  return null;
}
```

**Single Click vs Box Selection:**

| Selection Type | Points Array | Return Value |
|---------------|--------------|--------------|
| Single click on 2020 | `[{x: '2020'}]` | `'2020'` |
| Box select 2015-2020 | `[{x: '2015'}, {x: '2016'}, ...]` | `'2015|2020'` |

**Duplicate Removal:**

When a stacked bar chart has box selection, clicking might return the same year twice (once for each trace). Using `[...new Set(years)]` ensures each year appears only once.