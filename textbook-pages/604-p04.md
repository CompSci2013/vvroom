---

### Step 604.2: Understand the Query Control Filter Structure

Each query control filter definition has these key properties:

| Property | Type | Description |
|----------|------|-------------|
| `field` | `string` | Property name in AutoSearchFilters |
| `label` | `string` | Display text in filter list and dialog title |
| `type` | `'multiselect' \| 'range'` | Filter UI type |
| `optionsEndpoint` | `string` | API endpoint to fetch options |
| `optionsTransformer` | `function` | Transform API response to FilterOption[] |
| `urlParams` | `string \| object` | URL parameter name(s) for this filter |
| `searchPlaceholder` | `string` | Placeholder text in search input |
| `dialogSubtitle` | `string` | Help text shown in filter dialog |

**For Range Filters:**

| Property | Type | Description |
|----------|------|-------------|
| `rangeConfig.valueType` | `'integer' \| 'float'` | Numeric type |
| `rangeConfig.minLabel` | `string` | Label for min input |
| `rangeConfig.maxLabel` | `string` | Label for max input |
| `rangeConfig.step` | `number` | Input step value |
| `rangeConfig.useGrouping` | `boolean` | Use thousand separators |
| `rangeConfig.defaultRange` | `{ min, max }` | Default range limits |

---

### Step 604.3: Understanding the Options Transformer

The `optionsTransformer` function converts API responses to the standard `FilterOption[]` format:

```typescript
// API Response (raw)
{
  manufacturers: ["Ford", "Toyota", "Honda", "BMW"]
}

// After optionsTransformer
[
  { value: "Ford", label: "Ford" },
  { value: "Toyota", label: "Toyota" },
  { value: "Honda", label: "Honda" },
  { value: "BMW", label: "BMW" }
]
```

**Why this pattern?**

Different APIs return data in different formats:
- Some return arrays of strings
- Some return arrays of objects with id/name
- Some return nested structures

The transformer normalizes all formats to `{ value, label }`.

**Complex Example (Model Combinations):**

```typescript
// API Response (raw)
{
  data: [
    {
      manufacturer: "Ford",
      count: 100,
      models: [
        { model: "F-150", count: 50 },
        { model: "Mustang", count: 30 }
      ]
    },
    {
      manufacturer: "Toyota",
      count: 80,
      models: [
        { model: "Camry", count: 40 }
      ]
    }
  ]
}

// After optionsTransformer
[
  { value: "Ford:F-150", label: "Ford: F-150" },
  { value: "Ford:Mustang", label: "Ford: Mustang" },
  { value: "Toyota:Camry", label: "Toyota: Camry" }
]
```