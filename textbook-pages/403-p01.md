# 403: Domain Filter and Statistics Models

**Status:** Complete
**Depends On:** 401-base-model-interface, 402-domain-data-models
**Blocks:** Phase 5 (Domain Adapters), Phase 6 (Charts)

---

## Learning Objectives

After completing this section, you will:
- Understand the difference between filter models and data models
- Know how to model search filters with pagination and sorting
- Recognize the structure of aggregated statistics for chart data
- Be able to implement highlight filters for segmented chart data

---

## Objective

Create the filter model (`AutoSearchFilters`) for search parameters and the statistics models (`VehicleStatistics`, `ManufacturerStat`, etc.) for chart and analytics data.

---

## Why

### Filter Models

When users search for vehicles, they apply filters:
- Manufacturer (Toyota)
- Year range (2020-2024)
- Body class (Sedan, SUV)
- Page number (1)
- Sort field (manufacturer)

These filters:
1. **Map to URL parameters** — Filters persist in the URL
2. **Map to API query strings** — Sent to backend for filtering
3. **Support multiple data types** — Strings, numbers, arrays

The `AutoSearchFilters` class models all filter options with utility methods for checking if filters are active.

### Highlight Filters

Vvroom supports **chart highlighting** — showing a subset of data emphasized within the total:

```
Total vehicles by manufacturer:
┌──────────────────────────────────────────────┐
│ Toyota    ██████████████████░░░░░ 234 (45 highlighted) │
│ Honda     ████████████████░░░░░░░ 187 (32 highlighted) │
│ Ford      ████████████░░░░░░░░░░░ 156 (0 highlighted)  │
└──────────────────────────────────────────────┘
```

Highlight filters are sent to the API with `h_` prefix:
- `?h_manufacturer=Toyota` — Highlight Toyota vehicles
- `?h_yearMin=2020&h_yearMax=2024` — Highlight 2020-2024 vehicles

The API returns segmented data: `{ total: 234, highlighted: 45 }`

### Statistics Models

Statistics provide aggregated data for:
- **Summary cards** — Total vehicles, total VINs, manufacturer count
- **Charts** — Top manufacturers, body class distribution, year distribution
- **Filters** — Year range for slider min/max

Statistics models handle two API response formats:

**Format 1: Array-based** (simpler endpoints)
```json
{
  "total_vehicles": 1247,
  "top_manufacturers": [
    { "name": "Toyota", "count": 234 }
  ]
}
```

**Format 2: Segmented** (chart-ready)
```json
{
  "byManufacturer": {
    "Toyota": { "total": 234, "highlighted": 45 },
    "Honda": { "total": 187, "highlighted": 32 }
  }
}
```

The `VehicleStatistics.fromApiResponse()` method detects and handles both formats.