---

### Step 307.2: Verify Popout Interface Exists

Ensure `src/app/framework/models/popout.interface.ts` exists (from Section 208).

If the interface doesn't include `parsePopOutRoute`, add it:

```typescript
// Add to src/app/framework/models/popout.interface.ts
// VERSION 2 (Section 307) - Added parsePopOutRoute function

/**
 * Parse pop-out route to extract context
 *
 * @param url - Current router URL
 * @returns PopOutContext with parsed values, or default context if not pop-out
 *
 * @example
 * ```typescript
 * parsePopOutRoute('/popout/main-grid/stats-1/statistics-panel-2')
 * // Returns: { isPopOut: true, gridId: 'main-grid', panelId: 'stats-1', panelType: 'statistics-panel-2' }
 *
 * parsePopOutRoute('/discover')
 * // Returns: { isPopOut: false, gridId: '', panelId: '', panelType: '' }
 * ```
 */
export function parsePopOutRoute(url: string): PopOutContext {
  // Pattern: /popout/:gridId/:panelId/:panelType
  const match = url.match(/^\/popout\/([^\/]+)\/([^\/]+)\/([^\/\?]+)/);

  if (match) {
    return {
      isPopOut: true,
      gridId: match[1],
      panelId: match[2],
      panelType: match[3]
    };
  }

  return {
    isPopOut: false,
    gridId: '',
    panelId: '',
    panelType: ''
  };
}
```

---

### Step 307.3: Update the Barrel File

The barrel file should already export this service from Section 306. Verify:

```typescript
// src/app/framework/services/index.ts
export * from './popout-context.service';
```

---

## Verification

### 1. Check File Updated

```bash
$ wc -l src/app/framework/services/popout-context.service.ts
```

Should show ~200+ lines (not the short placeholder).

### 2. TypeScript Compilation Check

```bash
$ npx tsc --noEmit src/app/framework/services/popout-context.service.ts
```

Expected: No output (no compilation errors).

### 3. Build the Application

```bash
$ ng build
```

Expected: Build succeeds with no errors.

### 4. Verify Context Detection (Optional)

Add temporary test code:

```typescript
// In app.component.ts
import { PopOutContextService } from './framework/services';

constructor(private popOutContext: PopOutContextService) {
  console.log('Is pop-out?', this.popOutContext.isInPopOut());
  console.log('Context:', this.popOutContext.getContext());
}
```

Navigate to `/` — Should log `Is pop-out? false`
Navigate to `/popout/grid1/panel1/stats` — Should log `Is pop-out? true`