---

### Step 654.5: Understanding the Larger Bottom Margin

The top models chart uses the largest bottom margin:

```typescript
margin: {
  l: 60,
  r: 40,
  t: 40,
  b: 140  // Largest of all charts
}
```

**Why 140px?**

Model labels are the longest of any chart:
- "Toyota Camry" — Short
- "Mercedes-Benz S-Class" — Medium
- "Lamborghini Aventador LP700-4" — Long

When angled at -45 degrees, these long labels need substantial vertical space to remain readable without overlapping or being cut off.

---

### Step 654.6: Understanding the Segmentation Check

The segmentation check for top models is more complex:

```typescript
const hasSegmentedStats = statistics.modelsByManufacturer &&
  Object.values(statistics.modelsByManufacturer).some(models =>
    typeof models === 'object' && Object.values(models).some(v =>
      typeof v === 'object' && 'total' in v
    )
  );
```

**Why so complex?**

Unlike `byManufacturer` (which is one level deep), `modelsByManufacturer` is two levels deep:

```
modelsByManufacturer → manufacturer → model → { total, highlighted }
```

We need to:
1. Check that `modelsByManufacturer` exists
2. Check that at least one manufacturer has models
3. Check that at least one model has the `{ total, highlighted }` structure

This defensive checking prevents runtime errors when data is missing or in an unexpected format.

---

## Verification

### 1. TypeScript Compilation

```bash
$ cd ~/projects/vvroom
$ ng build
```

Expected: Build succeeds with no errors.

### 2. File Location

```bash
$ ls -la src/app/domain-config/automobile/chart-sources/
```

Expected:

```
-rw-r--r-- 1 user user  4567 Feb  9 17:00 manufacturer-chart-source.ts
-rw-r--r-- 1 user user  4123 Feb  9 17:05 year-chart-source.ts
-rw-r--r-- 1 user user  4234 Feb  9 17:10 body-class-chart-source.ts
-rw-r--r-- 1 user user  4789 Feb  9 17:15 top-models-chart-source.ts
```

### 3. Label Conversion Test

Mentally trace the click handler:

```typescript
// Input from Plotly click event
event.points = [{ x: "Toyota Camry" }, { x: "Honda Accord" }]

// After processing
// uniqueLabels = ["Toyota Camry", "Honda Accord"]
// modelCombos = ["Toyota:Camry", "Honda:Accord"]
// return value = "Toyota:Camry,Honda:Accord"

// URL parameter
// ?modelCombos=Toyota:Camry,Honda:Accord
```