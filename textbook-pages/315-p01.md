# 315: Pop-Out Token

**Status:** Complete
**Depends On:** 307-popout-context-service
**Blocks:** Phase 8 (Framework Components)

---

## Learning Objectives

After completing this section, you will:
- Understand how Angular injection tokens work
- Know when to use tokens vs services for dependency injection
- Recognize the benefits of compile-time constants for environment detection
- Be able to create and provide injection tokens

---

## Objective

Create the `IS_POPOUT_TOKEN` injection token that provides a boolean indicating whether the current window is a pop-out window. This token is used throughout the application to conditionally render components and enable/disable features based on pop-out context.

---

## Why

Pop-out windows need to behave differently from the main window:

| Behavior | Main Window | Pop-Out Window |
|----------|-------------|----------------|
| Navigation header | Shown | Hidden |
| Pop-out buttons | Enabled | Disabled (already popped out) |
| Close button | Hidden | Shown |
| State sync | Source | Receiver |

Components need to know "Am I in a pop-out?" to adjust their behavior.

### Option 1: Call a Service Method

```typescript
// In every component
constructor(private popoutContext: PopOutContextService) {}

get isPopOut(): boolean {
  return this.popoutContext.isInPopOut();
}
```

Problem: Every component needs to inject the service and call the method.

### Option 2: Use an Injection Token (Our Approach)

```typescript
// In any component
constructor(@Inject(IS_POPOUT_TOKEN) public isPopOut: boolean) {}
```

Benefits:
- **Simpler injection** — Just inject the boolean directly
- **Compile-time constant** — Value determined once at bootstrap
- **Template-friendly** — Use directly in templates: `*ngIf="!isPopOut"`
- **Testable** — Easy to provide different values in tests

### How It Works

1. **At bootstrap**, the router URL is checked for `/popout/` prefix
2. **A factory function** returns `true` or `false`
3. **The token is provided** at root level with this value
4. **Components inject** the token to get the boolean

```typescript
// Factory determines value once
export function isPopOutFactory(router: Router): boolean {
  return router.url.includes('/popout/');
}

// Provided at root
{
  provide: IS_POPOUT_TOKEN,
  useFactory: isPopOutFactory,
  deps: [Router]
}

// Injected in component
constructor(@Inject(IS_POPOUT_TOKEN) private isPopOut: boolean) {
  if (this.isPopOut) {
    // Pop-out specific behavior
  }
}
```