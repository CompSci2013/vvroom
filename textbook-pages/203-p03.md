```typescript
// src/app/framework/models/filter-definition.interface.ts
// VERSION 1 (Section 203) - Filter definition interfaces for Query Control

/**
 * Filter Definition Interface
 *
 * Defines the structure for filterable fields in the Query Control component.
 * This is domain-agnostic and works with any domain configuration.
 */

/**
 * Configuration for range-type filters
 *
 * Supports integer, decimal, and datetime ranges with flexible formatting.
 *
 * @example
 * ```typescript
 * // Year range (integer, no grouping)
 * rangeConfig: {
 *   valueType: 'integer',
 *   minLabel: 'Start Year',
 *   maxLabel: 'End Year',
 *   minPlaceholder: 'e.g., 1980',
 *   maxPlaceholder: 'e.g., 2023',
 *   step: 1,
 *   useGrouping: false,
 *   defaultRange: { min: 1900, max: new Date().getFullYear() }
 * }
 *
 * // Price range (decimal, with grouping)
 * rangeConfig: {
 *   valueType: 'decimal',
 *   minLabel: 'Min Price',
 *   maxLabel: 'Max Price',
 *   step: 0.01,
 *   decimalPlaces: 2,
 *   useGrouping: true,
 *   defaultRange: { min: 0, max: 1000000 }
 * }
 * ```
 */
export interface RangeConfig {
  /**
   * The type of values in the range
   * - 'integer': Whole numbers (years, counts)
   * - 'decimal': Floating point numbers (prices, measurements)
   * - 'datetime': Date/time values (ISO 8601 format)
   */
  valueType: 'integer' | 'decimal' | 'datetime';

  /**
   * Label for the minimum value input
   * @example "Start Year", "Min Price"
   */
  minLabel: string;

  /**
   * Label for the maximum value input
   * @example "End Year", "Max Price"
   */
  maxLabel: string;

  /**
   * Placeholder text for min input
   * @example "e.g., 1980"
   */
  minPlaceholder?: string;

  /**
   * Placeholder text for max input
   * @example "e.g., 2023"
   */
  maxPlaceholder?: string;

  /**
   * Step increment for numeric inputs
   * @default 1 for integer, 0.01 for decimal
   */
  step?: number;

  /**
   * Number of decimal places for 'decimal' type
   * @default 2
   */
  decimalPlaces?: number;

  /**
   * Whether to use thousand separators in display
   * Set to false for years to avoid "2,024"
   * @default false
   */
  useGrouping?: boolean;

  /**
   * Default min/max values when API doesn't provide them
   */
  defaultRange?: { min: number; max: number };
}

/**
 * Defines a filterable field in the domain
 *
 * This interface is used in DomainConfig.queryControlFilters array
 * to define all available filters for the Query Control component.
 *
 * @template T - The filter model type that contains these fields
 *
 * @example
 * ```typescript
 * // Multiselect filter for manufacturer
 * const manufacturerFilter: FilterDefinition<AutomobileFilters> = {
 *   field: 'manufacturer',
 *   label: 'Manufacturer',
 *   type: 'multiselect',
 *   optionsEndpoint: '/agg/manufacturers',
 *   urlParams: 'manufacturer',
 *   searchPlaceholder: 'Search manufacturers...',
 *   dialogTitle: 'Select Manufacturers'
 * };
 *
 * // Range filter for year
 * const yearFilter: FilterDefinition<AutomobileFilters> = {
 *   field: 'year',
 *   label: 'Model Year',
 *   type: 'range',
 *   urlParams: { min: 'yearMin', max: 'yearMax' },
 *   rangeConfig: {
 *     valueType: 'integer',
 *     minLabel: 'Start Year',
 *     maxLabel: 'End Year',
 *     useGrouping: false,
 *     defaultRange: { min: 1900, max: 2025 }
 *   }
 * };
 * ```
 */
export interface FilterDefinition<T = any> {
  /**
   * Unique field identifier matching a property in the filter model
   * Uses keyof T for type safety
   */
  field: keyof T;

  /**
   * Display label for the filter shown in Query Control component
   */
  label: string;

  /**
   * Filter type determines the UI component rendered
   * - 'multiselect': Dropdown with checkboxes
   * - 'range': Two inputs for min/max values
   * - 'text': Single text input
   * - 'date': Date picker
   */
  type: 'multiselect' | 'range' | 'text' | 'date';

  /**
   * API endpoint for fetching multiselect filter options
   * Relative to the domain's apiBaseUrl
   *
   * @example 'agg/manufacturers'
   * Fetches from: {apiBaseUrl}/agg/manufacturers
   */
  optionsEndpoint?: string;

  /**
   * Transformer function to convert API response to FilterOption[]
   * Required when API response doesn't match expected format
   *
   * @example
   * optionsTransformer: (response) => response.values.map(v => ({
   *   value: v.name,
   *   label: v.name,
   *   count: v.count
   * }))
   */
  optionsTransformer?: (response: any) => FilterOption[];

  /**
   * URL parameter name(s) for state synchronization
   *
   * For simple filters (text, multiselect): string
   * For range filters: object with min and max keys
   *
   * @example
   * urlParams: 'manufacturer'           // ?manufacturer=Ford,Toyota
   * urlParams: { min: 'yearMin', max: 'yearMax' }  // ?yearMin=2020&yearMax=2024
   */
  urlParams: string | { min: string; max: string };

  /**
   * Placeholder text for search box in multiselect dialogs
   */
  searchPlaceholder?: string;

  /**
   * Subtitle text shown in filter dialog/modal
   */
  dialogSubtitle?: string;

  /**
   * Title for the filter dialog
   * @default "Select {label}"
   */
  dialogTitle?: string;

  /**
   * Configuration for type='range' filters
   * Required when type is 'range'
   */
  rangeConfig?: RangeConfig;
}

/**
 * Option for multiselect filters
 *
 * Represents a single selectable option in a multiselect dropdown.
 *
 * @example
 * ```typescript
 * // API response format (from /agg/manufacturers endpoint)
 * {
 *   field: "manufacturer",
 *   values: [
 *     { value: "Toyota", label: "Toyota", count: 1543 },
 *     { value: "Honda", label: "Honda", count: 1234 },
 *     { value: "Ford", label: "Ford", count: 987 }
 *   ]
 * }
 * ```
 */
export interface FilterOption {
  /**
   * The actual value used when filter is selected
   * Sent to API and stored in URL
   */
  value: string | number;

  /**
   * Display text shown to user in dropdown
   */
  label: string;

  /**
   * Optional count of items matching this option
   * Displayed as badge: "Toyota (1,543)"
   */
  count?: number;
}

/**
 * Default transformer for standard API aggregation responses
 *
 * Converts the standard aggregation response format to FilterOption[].
 * Use this when your API returns the expected format.
 *
 * @param response - API response with { field, values } structure
 * @returns Array of FilterOption objects
 *
 * @example
 * ```typescript
 * // API response:
 * { field: "manufacturer", values: [{ value: "Ford", count: 100 }] }
 *
 * // Result:
 * [{ value: "Ford", label: "Ford", count: 100 }]
 * ```
 */
export function defaultOptionsTransformer(response: {
  field: string;
  values: Array<{ value: string | number; count?: number }>;
}): FilterOption[] {
  return response.values.map((v) => ({
    value: v.value,
    label: String(v.value),
    count: v.count
  }));
}

/**
 * Get URL parameter names from a filter definition
 *
 * Utility function to extract URL parameter names regardless of format.
 *
 * @param filter - Filter definition
 * @returns Array of URL parameter names
 *
 * @example
 * ```typescript
 * getUrlParamNames({ urlParams: 'manufacturer' }) // ['manufacturer']
 * getUrlParamNames({ urlParams: { min: 'yearMin', max: 'yearMax' } }) // ['yearMin', 'yearMax']
 * ```
 */
export function getUrlParamNames(filter: FilterDefinition): string[] {
  if (typeof filter.urlParams === 'string') {
    return [filter.urlParams];
  }
  return [filter.urlParams.min, filter.urlParams.max];
}

/**
 * Check if a filter definition is a range filter
 *
 * @param filter - Filter definition
 * @returns True if filter type is 'range'
 */
export function isRangeFilter(filter: FilterDefinition): boolean {
  return filter.type === 'range';
}

/**
 * Check if a filter definition has URL range params
 *
 * @param urlParams - URL params from filter definition
 * @returns True if urlParams is a min/max object
 */
export function hasRangeUrlParams(
  urlParams: string | { min: string; max: string }
): urlParams is { min: string; max: string } {
  return typeof urlParams === 'object' && 'min' in urlParams && 'max' in urlParams;
}
```