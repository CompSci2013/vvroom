---

### Step 651.4: Understanding URL Parameter Mapping

The `toUrlParams` method converts a clicked chart value into URL query parameters:

```typescript
toUrlParams(value: string, isHighlightMode: boolean): Record<string, any> {
  const paramName = isHighlightMode ? 'h_manufacturer' : 'manufacturer';
  return { [paramName]: value };
}
```

**Filter Mode vs Highlight Mode:**

- **Filter mode** (default): Click filters the dataset → `manufacturer=Toyota`
- **Highlight mode** (h key held): Click adds a highlight → `h_manufacturer=Toyota`

This dual-mode interaction follows the URL-First pattern: user actions translate directly to URL changes.

---

## Verification

### 1. TypeScript Compilation

```bash
$ cd ~/projects/vvroom
$ ng build
```

Expected: Build succeeds with no errors.

### 2. File Location

```bash
$ ls -la src/app/domain-config/automobile/chart-sources/
```

Expected:

```
-rw-r--r-- 1 user user  4567 Feb  9 17:00 manufacturer-chart-source.ts
```

### 3. Export Check

Once the chart configs are updated (document 606), verify the class is importable:

```typescript
import { ManufacturerChartDataSource } from './chart-sources/manufacturer-chart-source';
```

---

## Common Problems

| Symptom | Cause | Solution |
|---------|-------|----------|
| `Cannot find module '../../../framework/components/base-chart/base-chart.component'` | BaseChartComponent not yet created | This is expected until Phase 8 (document 801) |
| `Cannot find module '../models/automobile.statistics'` | VehicleStatistics not created | Complete document 403 first |
| `Property 'byManufacturer' does not exist on type 'VehicleStatistics'` | Missing property in statistics model | Add `byManufacturer` property to VehicleStatistics |
| TypeScript error on `Plotly.Data` | Plotly types not installed | Run `npm install --save-dev @types/plotly.js` |

---

## Key Takeaways

1. **Chart data sources are transformers** — They convert domain data into visualization-ready formats
2. **Handle both simple and segmented data** — Statistics can come in multiple formats; check dynamically
3. **URL parameters enable interactivity** — Clicks on charts become filter or highlight URL changes