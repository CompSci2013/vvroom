---

## Common Problems

| Symptom | Cause | Solution |
|---------|-------|----------|
| `Cannot find module '../models/popout.interface'` | Interface file missing | Complete Section 208 first |
| `parsePopOutRoute is not a function` | Function not exported | Add to popout.interface.ts and export |
| isInPopOut always false | URL doesn't match pattern | Check URL pattern is `/popout/...` |
| Messages not received | Channel name mismatch | Verify both sides use `panel-{panelId}` |
| Change detection not running | Missing NgZone.run() | Wrap message handling in ngZone.run() |

---

## Key Takeaways

1. **BroadcastChannel enables simple cross-window messaging** — No window references needed
2. **URL pattern determines pop-out status** — Route-based detection is reliable
3. **ReplaySubject with buffer catches late subscribers** — Messages aren't lost

---

## Acceptance Criteria

- [ ] `src/app/framework/services/popout-context.service.ts` fully implemented
- [ ] `isInPopOut()` correctly detects pop-out windows by URL pattern
- [ ] `getContext()` returns parsed gridId, panelId, panelType
- [ ] `initializeAsPopOut()` sets up BroadcastChannel
- [ ] `initializeAsParent()` sets initialized flag
- [ ] `sendMessage()` sends via BroadcastChannel
- [ ] `getMessages$()` returns observable of incoming messages
- [ ] `createChannelForPanel()` creates channels for parent use
- [ ] `parsePopOutRoute()` function added to popout.interface.ts
- [ ] NgZone.run() wraps message handling
- [ ] TypeScript compilation succeeds
- [ ] JSDoc comments document all public methods

---

## Next Step

Proceed to `308-popout-manager-service.md` to create the service that manages pop-out windows from the main window.