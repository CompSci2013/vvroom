---

## Common Problems

| Symptom | Cause | Solution |
|---------|-------|----------|
| `Cannot find module '@angular/router'` | RouterModule not imported | Ensure RouterModule is in app.module.ts imports |
| Console shows empty object `{}` | Route not configured | Ensure routes exist in app-routing.module.ts |
| Params not updating on child route navigation | Wrong ActivatedRoute | Using Router.events (as implemented) solves this |
| Change detection not running | Missing NgZone | Ensure ngZone.run() wraps paramsSubject.next() |
| Duplicate console logs | Multiple emissions | distinctUntilChanged() should prevent this |
| URL not updating on setParams() | Navigation blocked | Check for route guards or canDeactivate |

---

## Key Takeaways

1. **The URL is the single source of truth** — Components read state from the URL, they don't maintain their own copy
2. **BehaviorSubject enables both sync and async access** — `.value` for sync, `.asObservable()` for reactive streams
3. **Root services need special URL handling** — Use `Router.events` and `router.parseUrl()` instead of `ActivatedRoute.queryParams`

---

## Acceptance Criteria

- [ ] `src/app/framework/services/url-state.service.ts` exists with complete implementation
- [ ] `src/app/framework/services/index.ts` exports the service
- [ ] Service is `@Injectable({ providedIn: 'root' })` for singleton behavior
- [ ] `getParams<T>()` returns typed URL parameters synchronously
- [ ] `setParams<T>()` updates URL and triggers navigation
- [ ] `watchParams<T>()` returns observable stream of URL changes
- [ ] `distinctUntilChanged()` prevents duplicate emissions
- [ ] Service handles child route query params correctly via Router.events
- [ ] NgZone.run() ensures Angular change detection runs
- [ ] TypeScript compilation succeeds with no errors
- [ ] JSDoc comments document all public methods

---

## Next Step

Proceed to `302-api-service.md` to create the service for making HTTP requests to the API.