# 654: Top Models Chart Source

**Status:** Planning
**Depends On:** 403-automobile-statistics-model, 653-body-class-chart-source
**Blocks:** 801-base-chart-component

---

## Learning Objectives

After completing this section, you will:
- Understand how to transform nested data structures for visualization
- Know how to implement composite URL parameters from chart clicks
- Be able to handle data from multiple API response formats

---

## Objective

Create the top models chart data source that transforms vehicle statistics into a Plotly.js bar chart showing the top models by VIN instance count. This chart source handles nested data structures (`modelsByManufacturer`) and produces composite URL parameters (`manufacturer:model` format).

---

## Why

The top models chart presents unique challenges that the previous chart sources did not:

1. **Nested data structure** — Models are nested within manufacturers in the API response
2. **Composite labels** — Each bar shows "Manufacturer Model" (e.g., "Toyota Camry")
3. **Composite URL parameters** — Clicking produces `modelCombos=Toyota:Camry`, not separate parameters
4. **Two data sources** — Can use either `topModels` array or `modelsByManufacturer` object

This complexity demonstrates why we keep chart sources as separate classes rather than abstracting too aggressively. Each chart source handles its unique requirements while maintaining the same interface.

### Design Decision: Combined Manufacturer-Model Format

When a user clicks on a model bar, we need to filter by both manufacturer AND model. We combine these into a single URL parameter using colon separator:

```
?modelCombos=Toyota:Camry
```

This approach:
- **Avoids ambiguity** — "Camry" alone could match multiple manufacturers if the API had duplicates
- **Supports multi-select** — `modelCombos=Toyota:Camry,Honda:Accord` selects multiple models
- **Matches API expectations** — The backend parses this format for efficient filtering

### URL-First Architecture Reference

The top models chart shows how chart sources can produce complex URL structures. The `handleClick` method transforms display format ("Toyota Camry") to URL format ("Toyota:Camry"), demonstrating that chart sources aren't just data transformers but also interaction translators.