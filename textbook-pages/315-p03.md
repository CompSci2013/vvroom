```typescript
// src/app/framework/tokens/popout.token.ts
// VERSION 2 (Section 315) - Added factory function

import { InjectionToken } from '@angular/core';

/**
 * Injection token for pop-out window detection
 *
 * Provides a boolean indicating whether the current window is a pop-out window.
 * This value is determined once at bootstrap based on the URL and never changes.
 *
 * **Usage:**
 *
 * ```typescript
 * constructor(@Inject(IS_POPOUT_TOKEN) public isPopOut: boolean) {}
 * ```
 *
 * **In Templates:**
 *
 * ```html
 * <nav *ngIf="!isPopOut">Main navigation</nav>
 * <button *ngIf="isPopOut" (click)="close()">Close</button>
 * ```
 */
export const IS_POPOUT_TOKEN = new InjectionToken<boolean>('IS_POPOUT_TOKEN');

/**
 * Factory function to determine if current window is a pop-out
 *
 * Checks the current URL pathname for the `/popout/` prefix.
 * This is called once during application bootstrap.
 *
 * @returns True if the current window is a pop-out window
 *
 * @example
 * ```typescript
 * // In app.module.ts
 * {
 *   provide: IS_POPOUT_TOKEN,
 *   useFactory: isPopOutFactory
 * }
 * ```
 */
export function isPopOutFactory(): boolean {
  // Check URL for popout prefix
  // Pop-out routes follow pattern: /popout/:panelId/:viewType
  return window.location.pathname.includes('/popout/');
}

/**
 * Provider configuration for IS_POPOUT_TOKEN
 *
 * Use this in your app.module.ts providers array.
 *
 * @example
 * ```typescript
 * import { IS_POPOUT_PROVIDER } from './framework/tokens';
 *
 * @NgModule({
 *   providers: [IS_POPOUT_PROVIDER]
 * })
 * export class AppModule { }
 * ```
 */
export const IS_POPOUT_PROVIDER = {
  provide: IS_POPOUT_TOKEN,
  useFactory: isPopOutFactory
};
```

---

### Step 315.4: Update the Barrel File

Update `src/app/framework/tokens/index.ts`:

```typescript
// src/app/framework/tokens/index.ts
// VERSION 1 (Section 315) - Framework injection tokens

export * from './popout.token';
```

---

### Step 315.5: Register the Provider

Update `src/app/app.module.ts` to provide the token:

```typescript
// src/app/app.module.ts (partial - add to existing)
import { IS_POPOUT_PROVIDER } from './framework/tokens';

@NgModule({
  // ...
  providers: [
    IS_POPOUT_PROVIDER
    // ... other providers
  ],
  // ...
})
export class AppModule { }
```