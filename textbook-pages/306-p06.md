---

## Verification

### 1. Check Files Exist

```bash
$ ls -la src/app/framework/services/resource-management.service.ts
$ ls -la src/app/framework/services/popout-context.service.ts
$ ls -la src/app/framework/tokens/popout.token.ts
```

### 2. TypeScript Compilation Check

```bash
$ npx tsc --noEmit src/app/framework/services/resource-management.service.ts
```

### 3. Build the Application

```bash
$ ng build
```

Expected: Build succeeds with no errors.

### 4. Run Demo Component

```bash
$ ng serve
```

Navigate to `http://localhost:4200/demo` and:

1. Click "Set manufacturer=Ford"
2. Observe URL changes to `?manufacturer=Ford`
3. Observe Current URL Params updates
4. Use browser back button
5. Observe params revert

**This is the Phase 3A Aha Moment in action:**

"The URL is the single source of truth. Components react to URL changes, they don't control them."

---

## Common Problems

| Symptom | Cause | Solution |
|---------|-------|----------|
| `Cannot find module '../tokens/popout.token'` | Token file not created | Create the token file in Step 306.1 |
| `No provider for DOMAIN_CONFIG` | Missing provider | Add provider in component or module |
| State not updating | Missing subscription | Ensure component subscribes to observables |
| Infinite loop on filter change | Filter update triggers URL, URL triggers fetch | Check distinctUntilChanged is working |
| Pop-out doesn't receive state | syncStateFromExternal not called | Implement message passing (Phase 3B) |

---

## Key Takeaways

1. **URL is the single source of truth** — updateFilters() modifies URL, not internal state
2. **State flows one direction** — URL → filters → API → results → components
3. **Component-level injection enables isolation** — Each component gets its own instance
4. **Pop-out awareness prevents duplicate fetches** — Main window fetches, pop-outs sync

---

## Acceptance Criteria

- [ ] `src/app/framework/services/resource-management.service.ts` exists
- [ ] `src/app/framework/services/popout-context.service.ts` exists (placeholder)
- [ ] `src/app/framework/tokens/popout.token.ts` exists
- [ ] Service is `@Injectable()` (not providedIn: 'root')
- [ ] Observable streams: filters$, results$, loading$, error$, statistics$
- [ ] `updateFilters()` updates URL, not internal state directly
- [ ] `clearFilters()` resets to default filters
- [ ] `refresh()` forces new data fetch
- [ ] `syncStateFromExternal()` enables pop-out state sync
- [ ] autoFetch disabled in pop-out windows
- [ ] Proper cleanup via ngOnDestroy()
- [ ] TypeScript compilation succeeds
- [ ] Demo component works as described