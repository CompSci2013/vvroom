---

## Verification

### 1. Check Files Exist

```bash
$ ls -la src/app/framework/tokens/
```

Expected output:

```
total 12
drwxr-xr-x 2 user user 4096 Feb  9 12:00 .
drwxr-xr-x 5 user user 4096 Feb  9 12:00 ..
-rw-r--r-- 1 user user  123 Feb  9 12:00 index.ts
-rw-r--r-- 1 user user 1456 Feb  9 12:00 popout.token.ts
```

### 2. TypeScript Compilation Check

```bash
$ npx tsc --noEmit src/app/framework/tokens/popout.token.ts
```

### 3. Build the Application

```bash
$ ng build
```

### 4. Test Token Injection

Add temporary test code:

```typescript
// In any component
import { Inject } from '@angular/core';
import { IS_POPOUT_TOKEN } from './framework/tokens';

@Component({...})
export class TestComponent {
  constructor(@Inject(IS_POPOUT_TOKEN) private isPopOut: boolean) {
    console.log('Is pop-out window:', this.isPopOut);
  }
}
```

### 5. Verify Pop-Out Detection

1. Navigate to `http://localhost:4200/discover` → Console shows `false`
2. Navigate to `http://localhost:4200/popout/panel-1/chart` → Console shows `true`

---

## Common Problems

| Symptom | Cause | Solution |
|---------|-------|----------|
| `NullInjectorError: No provider for IS_POPOUT_TOKEN` | Token not provided | Add `IS_POPOUT_PROVIDER` to app.module.ts |
| Token always `false` | URL checked before navigation | Factory uses `window.location.pathname`, not Router |
| Token value changes | Token recreated per component | Ensure `providedIn: 'root'` behavior via app.module.ts |
| TypeScript error on `@Inject` | Missing import | Import `Inject` from `@angular/core` |

---

## Key Takeaways

1. **Injection tokens provide primitive values** — Use when you need a simple value, not a service
2. **Factory functions compute values once** — The pop-out check runs at bootstrap only
3. **Tokens simplify component code** — No service method calls, just inject the boolean

---

## Acceptance Criteria

- [ ] `src/app/framework/tokens/popout.token.ts` exists
- [ ] `IS_POPOUT_TOKEN` defined as `InjectionToken<boolean>`
- [ ] `isPopOutFactory()` function returns boolean based on URL
- [ ] `IS_POPOUT_PROVIDER` object ready for app.module.ts
- [ ] Barrel file exports all token-related items
- [ ] Token correctly detects `/popout/` in URL pathname
- [ ] TypeScript compilation succeeds
- [ ] JSDoc comments document usage patterns