# 308: Popout Manager Service

**Status:** Complete
**Depends On:** 307-popout-context-service, 208-popout-interface
**Blocks:** Phase 9 (Feature Components)

---

## Learning Objectives

After completing this section, you will:
- Understand the window.open() API and its configuration options
- Know how to track pop-out window lifecycle (open, close)
- Recognize the state broadcast pattern for multi-window synchronization
- Be able to implement a comprehensive pop-out window manager

---

## Objective

Create the `PopOutManagerService` that opens, tracks, and communicates with pop-out windows from the main window. This service is the counterpart to `PopOutContextService` — one manages from the main window, the other runs inside pop-outs.

---

## Why

`PopOutContextService` handles the pop-out side. Now we need the parent side:

| Service | Runs In | Responsibility |
|---------|---------|----------------|
| PopOutContextService | Pop-out window | Receive state, send events |
| PopOutManagerService | Main window | Open pop-outs, broadcast state, track lifecycle |

### The Manager's Responsibilities

1. **Open pop-out windows** — Call `window.open()` with correct URL and features
2. **Track open pop-outs** — Know which panels are currently popped out
3. **Broadcast state** — Send state updates to all pop-out windows
4. **Handle closing** — Detect when pop-outs close and clean up
5. **Prevent duplicates** — Don't open same panel twice

### Why Component-Level Injection?

Unlike `PopOutContextService` (singleton), `PopOutManagerService` is component-level:

```typescript
@Component({
  providers: [PopOutManagerService]
})
export class DiscoverComponent { ... }
```

Reasons:
- Manager is tied to a specific grid/layout
- Different pages might have different pop-out needs
- Cleanup is easier when tied to component lifecycle

### The State Broadcast Pattern

When filters change in the main window:

```
Main Window                          Pop-out Window
    │                                     │
    ├── Filters change                    │
    │                                     │
    ├── ResourceManagementService         │
    │   updates state$                    │
    │                                     │
    ├── Component subscribes to state$    │
    │                                     │
    ├── Component calls                   │
    │   popOutManager.broadcastState()    │
    │          │                          │
    │          └──── BroadcastChannel ───►│
    │                                     │
    │                                     ├── PopOutContextService
    │                                     │   receives message
    │                                     │
    │                                     ├── ResourceManagementService
    │                                     │   .syncStateFromExternal()
    │                                     │
    │                                     └── UI updates
```

Pop-outs never make API calls. They receive state from the main window.