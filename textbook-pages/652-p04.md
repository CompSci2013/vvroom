---

### Step 652.5: Understanding URL Parameter Conversion

The `toUrlParams` method handles both formats:

```typescript
toUrlParams(value: string, isHighlightMode: boolean): Record<string, any> {
  if (value.includes('|')) {
    // Year range: split into min/max params
    const [min, max] = value.split('|');
    return isHighlightMode
      ? { h_yearMin: min, h_yearMax: max }
      : { yearMin: min, yearMax: max };
  }
  // Single year
  const paramName = isHighlightMode ? 'h_year' : 'year';
  return { [paramName]: value };
}
```

**URL Examples:**

| User Action | Return Value | URL Parameters |
|-------------|--------------|----------------|
| Click 2020 | `'2020'` | `?year=2020` |
| Click 2020 (highlight mode) | `'2020'` | `?h_year=2020` |
| Box select 2015-2020 | `'2015|2020'` | `?yearMin=2015&yearMax=2020` |
| Box select 2015-2020 (highlight mode) | `'2015|2020'` | `?h_yearMin=2015&h_yearMax=2020` |

This demonstrates how a single abstract method can produce varied URL structures based on the interaction pattern.

---

## Verification

### 1. TypeScript Compilation

```bash
$ cd ~/projects/vvroom
$ ng build
```

Expected: Build succeeds with no errors.

### 2. File Location

```bash
$ ls -la src/app/domain-config/automobile/chart-sources/
```

Expected:

```
-rw-r--r-- 1 user user  4567 Feb  9 17:00 manufacturer-chart-source.ts
-rw-r--r-- 1 user user  4123 Feb  9 17:05 year-chart-source.ts
```

### 3. Sorting Verification

Mentally trace through the code with sample data:

```typescript
// Input (unsorted):
byYearRange: { "2022": 50, "2020": 100, "2021": 75 }

// After sorting:
// years = ["2020", "2021", "2022"]
// counts = [100, 75, 50]
```

The chart will show 2020 on the left with 100 vehicles, progressing to 2022 on the right with 50.

---

## Common Problems

| Symptom | Cause | Solution |
|---------|-------|----------|
| Years appear in random order | Missing or incorrect sort | Verify `parseInt(a[0], 10) - parseInt(b[0], 10)` sorts ascending |
| Decimal year labels (2020.5) | X-axis type not set to category | Add `type: 'category'` to xaxis config |
| Range selection returns duplicates | Missing duplicate removal | Ensure `[...new Set(years)]` is present |
| `yearMin=2020&yearMax=2020` for single click | Pipe split on non-pipe string | Check for `|` before splitting |
| `Cannot find module '../models/automobile.statistics'` | VehicleStatistics not created | Complete document 403 first |