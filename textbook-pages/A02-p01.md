# Appendix A02: URL-First Testing Rubric

## Overview

This rubric provides a systematic method for verifying URL-First State Management compliance across popped-in and popped-out controls. The URL is the single source of truth; all state changes must flow through URL updates.

---

## Test Categories

### Category 1: Main Window (Popped-In) Control Changes

Test that changes in the main window controls are reflected in:
- The browser URL parameters
- All other controls in the main window
- Any open pop-out windows

| Test ID | Test Description | Expected Behavior | Pass/Fail |
|---------|-----------------|-------------------|-----------|
| M1.1 | Change a query control filter (e.g., manufacturer dropdown) | URL updates with filter param; results table updates; statistics update | |
| M1.2 | Change a highlight filter (e.g., year range) | URL updates with `h_` prefixed param; highlighted rows change; pop-outs receive update | |
| M1.3 | Change pagination (page number) | URL updates with `page` param; table shows correct page | |
| M1.4 | Change page size | URL updates with `size` param; table row count matches | |
| M1.5 | Change sort column | URL updates with `sort` param; table re-sorts | |
| M1.6 | Change sort direction | URL updates with `sortDirection` param; table order reverses | |
| M1.7 | Clear all filters | URL params removed; controls reset to defaults; full dataset shown | |
| M1.8 | Apply multiple filters simultaneously | All filter params appear in URL; results reflect intersection | |

---

### Category 2: Pop-Out Window Control Changes

Test that changes in pop-out windows are communicated to the main window and reflected appropriately.

| Test ID | Test Description | Expected Behavior | Pass/Fail |
|---------|-----------------|-------------------|-----------|
| P2.1 | Change highlight filter in pop-out | Main window URL updates with `h_` param; main window highlights update | |
| P2.2 | Pop-out sends filter change message | BroadcastChannel message received by main window | |
| P2.3 | Pop-out does NOT update its own URL | Pop-out URL remains static (initial state only) | |
| P2.4 | Pop-out does NOT make its own API calls | Network tab shows no API requests from pop-out after initial load | |
| P2.5 | Pop-out receives state via BroadcastChannel | `syncStateFromExternal()` called; no API fetch triggered | |
| P2.6 | Multiple pop-outs stay synchronized | Change in one pop-out reflects in main window and all other pop-outs | |