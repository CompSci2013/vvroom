# 310: Filter Options Service

**Status:** Complete
**Depends On:** 302-api-service, 304-domain-config-registry
**Blocks:** Phase 8 (Framework Components - for filter dropdowns)

---

## Learning Objectives

After completing this section, you will:
- Understand why filter options caching matters for pop-outs
- Know how to implement a cache-first data loading pattern
- Recognize the transformer pattern for API response adaptation
- Be able to implement a service that supports cross-window option sharing

---

## Objective

Create the `FilterOptionsService` that caches filter dropdown options and supports cross-window sharing for pop-out windows.

---

## Why

Filter dropdowns (manufacturer, body class, year) need options from the API. Without caching:

1. **Duplicate requests** — Each dropdown fetches options independently
2. **Pop-out overhead** — Pop-out windows make their own API calls
3. **Slow UX** — Users wait for options to load

### The Pop-Out Challenge

Pop-out windows should NOT make API calls. They receive state from the main window. But what about filter options?

```
Main Window                     Pop-out Window
    │                                │
    ├── Load manufacturer options    │
    │   (API call)                   │
    │                                │
    ├── Load body class options      │
    │   (API call)                   │
    │                                │
    ├── Open pop-out                 │
    │   │                            │
    │   └── Broadcast state ────────►│
    │       (includes filter cache)  │
    │                                │
    │                                ├── FilterOptionsService
    │                                │   syncFromExternal()
    │                                │
    │                                └── Options available
    │                                    (no API calls!)
```

### Cache Structure

```typescript
{
  'http://api/manufacturers': {
    field: 'manufacturer',
    endpoint: 'http://api/manufacturers',
    options: [{ value: 'Ford', label: 'Ford' }, ...],
    rawResponse: { data: [...] },
    cachedAt: 1707500000000
  },
  'http://api/body-classes': {
    field: 'bodyClass',
    endpoint: 'http://api/body-classes',
    options: [{ value: 'Sedan', label: 'Sedan' }, ...],
    rawResponse: { data: [...] },
    cachedAt: 1707500001000
  }
}
```